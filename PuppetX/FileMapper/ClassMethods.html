<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: PuppetX::FileMapper::ClassMethods
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../PuppetX.html" title="PuppetX (module)">PuppetX</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../FileMapper.html" title="PuppetX::FileMapper (module)">FileMapper</a></span></span>
     &raquo; 
    <span class="title">ClassMethods</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: PuppetX::FileMapper::ClassMethods
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/puppetx/filemapper.rb</dd>
  
</dl>
<div class="clear"></div>





  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#mapped_files-instance_method" title="#mapped_files (instance method)">- (Object) <strong>mapped_files</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute mapped_files.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collect_providers_for_file-instance_method" title="#collect_providers_for_file (instance method)">- (Array&lt;Puppet::Provider&gt;) <strong>collect_providers_for_file</strong>(filename) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate an array of providers that should be flushed to a specific file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dirty_file%21-instance_method" title="#dirty_file! (instance method)">- (Object) <strong>dirty_file!</strong>(filename) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed%21-instance_method" title="#failed! (instance method)">- (Object) <strong>failed!</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed%3F-instance_method" title="#failed? (instance method)">- (Boolean) <strong>failed?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush_file-instance_method" title="#flush_file (instance method)">- (Object) <strong>flush_file</strong>(filename) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Flush all providers associated with the given file to disk.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initvars-instance_method" title="#initvars (instance method)">- (Object) <strong>initvars</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#instances-instance_method" title="#instances (instance method)">- (Array&lt;Puppet::Provider&gt;) <strong>instances</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all instances of the provider using this mixin.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_all_providers_from_disk-instance_method" title="#load_all_providers_from_disk (instance method)">- (Array&lt;Hash&lt;String, Hash&lt;Symbol, Object&gt;&gt;&gt;) <strong>load_all_providers_from_disk</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reads all files from disk and returns an array of hashes representing
provider instances.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mk_property_methods-instance_method" title="#mk_property_methods (instance method)">- (Object) <strong>mk_property_methods</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create attr_accessors for properties and mark the provider as dirty on
change.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">- (Object) <strong>new</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Register all provider instances with the class.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#perform_write-instance_method" title="#perform_write (instance method)">- (Object) <strong>perform_write</strong>(filename, contents) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>We have a dirty file and the new contents ready, back up the file and
perform the flush.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prefetch-instance_method" title="#prefetch (instance method)">- (Object) <strong>prefetch</strong>(resources = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Match up all resources that have existing providers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_class%21-instance_method" title="#validate_class! (instance method)">- (Object) <strong>validate_class!</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Validate that the required methods are available.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="mapped_files-instance_method">
  
    - (<tt>Object</tt>) <strong>mapped_files</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute mapped_files</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mapped_files'>mapped_files</span>
  <span class='ivar'>@mapped_files</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="collect_providers_for_file-instance_method">
  
    - (<tt>Array&lt;Puppet::Provider&gt;</tt>) <strong>collect_providers_for_file</strong>(filename) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate an array of providers that should be flushed to a specific file</p>

<p>Only providers that should be present will be returned regardless of the
containing file.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the file to find providers for</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Puppet::Provider&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221
222
223</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 219</span>

<span class='kw'>def</span> <span class='id identifier rubyid_collect_providers_for_file'>collect_providers_for_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
  <span class='ivar'>@all_providers</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_provider'>provider</span><span class='op'>|</span>
    <span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_select_file'>select_file</span> <span class='op'>==</span> <span class='id identifier rubyid_filename'>filename</span> <span class='kw'>and</span> <span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_ensure'>ensure</span> <span class='op'>==</span> <span class='symbol'>:present</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dirty_file!-instance_method">
  
    - (<tt>Object</tt>) <strong>dirty_file!</strong>(filename) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dirty_file!'>dirty_file!</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
  <span class='ivar'>@mapped_files</span><span class='lbracket'>[</span><span class='id identifier rubyid_filename'>filename</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:dirty</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="failed!-instance_method">
  
    - (<tt>Object</tt>) <strong>failed!</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 72</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed!'>failed!</span>
  <span class='ivar'>@failed</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="failed?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>failed?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 68</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed?'>failed?</span>
  <span class='ivar'>@failed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush_file-instance_method">
  
    - (<tt>Object</tt>) <strong>flush_file</strong>(filename) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Flush all providers associated with the given file to disk.</p>

<p>If the provider is in a failure state, the provider class will refuse to
flush any file, since we're in an unknown state.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The path of the file to be flushed</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 235</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flush_file'>flush_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_failed?'>failed?</span>
    <span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> is in an error state, refusing to flush file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@mapped_files</span><span class='lbracket'>[</span><span class='id identifier rubyid_filename'>filename</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:dirty</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_target_providers'>target_providers</span> <span class='op'>=</span> <span class='id identifier rubyid_collect_providers_for_file'>collect_providers_for_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file_contents'>file_contents</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_format_file'>format_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_target_providers'>target_providers</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_perform_write'>perform_write</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_file_contents'>file_contents</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> was requested to flush the file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='rbrace'>}</span><span class='tstring_content'>, but it was not marked as dirty - doing nothing.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='comment'># If something failed during the flush process, mark the provider as
</span>  <span class='comment'># failed. There's not much we can do about any file that's already been
</span>  <span class='comment'># flushed but we can stop smashing things.
</span>  <span class='ivar'>@failed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initvars-instance_method">
  
    - (<tt>Object</tt>) <strong>initvars</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 61</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initvars'>initvars</span>
  <span class='comment'># Mapped_files: [Hash&lt;filepath =&gt; Hash&lt;:dirty =&gt; Bool, :filetype =&gt; Filetype&gt;&gt;]
</span>  <span class='ivar'>@mapped_files</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
  <span class='ivar'>@failed</span>       <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@all_providers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="instances-instance_method">
  
    - (<tt>Array&lt;Puppet::Provider&gt;</tt>) <strong>instances</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all instances of the provider using this mixin.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Puppet::Provider&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_instances'>instances</span>
  <span class='id identifier rubyid_provider_hashes'>provider_hashes</span> <span class='op'>=</span> <span class='id identifier rubyid_load_all_providers_from_disk'>load_all_providers_from_disk</span>

  <span class='id identifier rubyid_provider_hashes'>provider_hashes</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span>
    <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:provider</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:ensure</span> <span class='op'>=&gt;</span> <span class='symbol'>:present</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

<span class='kw'>rescue</span>
  <span class='comment'># If something failed while loading instances, mark the provider class
</span>  <span class='comment'># as failed and pass the exception along
</span>  <span class='ivar'>@failed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_all_providers_from_disk-instance_method">
  
    - (<tt>Array&lt;Hash&lt;String, Hash&lt;Symbol, Object&gt;&gt;&gt;</tt>) <strong>load_all_providers_from_disk</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reads all files from disk and returns an array of hashes representing
provider instances.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><span class='const'>IncludingProvider</span><span class='period'>.</span><span class='id identifier rubyid_load_all_providers_from_disk'>load_all_providers_from_disk</span>
<span class='comment'># =&gt; [
</span><span class='comment'>#   { &quot;/path/to/file&quot; =&gt; {
</span><span class='comment'>#     :dirty    =&gt; false,
</span><span class='comment'>#     :filetype =&gt; #&lt;Puppet::Util::FileTypeFlat:0x007fbf5b05ff10&gt;,
</span><span class='comment'>#   },
</span><span class='comment'>#   { &quot;/path/to/another/file&quot; =&gt; {
</span><span class='comment'>#     :dirty    =&gt; false,
</span><span class='comment'>#     :filetype =&gt; #&lt;Puppet::Util::FileTypeFlat:0x007fbf5b05c108,
</span><span class='comment'>#   },
</span><span class='comment'>#</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&lt;String, Hash&lt;Symbol, Object&gt;&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array containing a set of hashes, keyed with a file path and values
being a hash containg the state of the file and the filetype associated
with it.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_all_providers_from_disk'>load_all_providers_from_disk</span>
  <span class='id identifier rubyid_validate_class!'>validate_class!</span>

  <span class='comment'># Retrieve a list of files to fetch, and cache a copy of a filetype
</span>  <span class='comment'># for each one
</span>  <span class='id identifier rubyid_target_files'>target_files</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
    <span class='ivar'>@mapped_files</span><span class='lbracket'>[</span><span class='id identifier rubyid_file'>file</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>FileType</span><span class='period'>.</span><span class='id identifier rubyid_filetype'>filetype</span><span class='lparen'>(</span><span class='symbol'>:flat</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='ivar'>@mapped_files</span><span class='lbracket'>[</span><span class='id identifier rubyid_file'>file</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:dirty</span><span class='rbracket'>]</span>    <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># Read and parse each file.
</span>  <span class='id identifier rubyid_provider_hashes'>provider_hashes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@mapped_files</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_file_attrs'>file_attrs</span><span class='op'>|</span>
    <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_file'>parse_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_file_attrs'>file_attrs</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_provider_hashes'>provider_hashes</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span> <span class='id identifier rubyid_arr'>arr</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_provider_hashes'>provider_hashes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mk_property_methods-instance_method">
  
    - (<tt>Object</tt>) <strong>mk_property_methods</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create attr_accessors for properties and mark the provider as dirty on
change.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mk_property_methods'>mk_property_methods</span>
  <span class='id identifier rubyid_resource_type'>resource_type</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span>
    <span class='id identifier rubyid_attr'>attr</span> <span class='op'>=</span> <span class='id identifier rubyid_symbolize'>symbolize</span><span class='lparen'>(</span><span class='id identifier rubyid_attr'>attr</span><span class='rparen'>)</span>

    <span class='comment'># Generate the attr_reader method
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_attr'>attr</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@property_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_attr'>attr</span><span class='rbracket'>]</span>
        <span class='ivar'>@property_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_attr'>attr</span><span class='rbracket'>]</span>
      <span class='kw'>elsif</span> <span class='kw'>defined?</span> <span class='ivar'>@resource</span>
        <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span><span class='lparen'>(</span><span class='id identifier rubyid_attr'>attr</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Generate the attr_writer and have it mark the resource as dirty when called
</span>    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attr'>attr</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
      <span class='ivar'>@property_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_attr'>attr</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_dirty!'>dirty!</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-instance_method">
  
    - (<tt>Object</tt>) <strong>new</strong>(*args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Register all provider instances with the class</p>

<p>In order to flush all provider instances to a given file, we need to be
able to track them all. When provider#flush is called and the file
associated with that provider instance is dirty, the file needs to be
flushed and all provider instances associated with that file will be passed
to self.flush_file</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 83</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='kw'>super</span>
  <span class='ivar'>@all_providers</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_obj'>obj</span>
  <span class='id identifier rubyid_obj'>obj</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="perform_write-instance_method">
  
    - (<tt>Object</tt>) <strong>perform_write</strong>(filename, contents) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>We have a dirty file and the new contents ready, back up the file and
perform the flush.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The destination filename</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>contents</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The new file contents</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263
264
265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 261</span>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_write'>perform_write</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_contents'>contents</span><span class='rparen'>)</span>
  <span class='ivar'>@mapped_files</span><span class='lbracket'>[</span><span class='id identifier rubyid_filename'>filename</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>FileType</span><span class='period'>.</span><span class='id identifier rubyid_filetype'>filetype</span><span class='lparen'>(</span><span class='symbol'>:flat</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_filetype'>filetype</span> <span class='op'>=</span> <span class='ivar'>@mapped_files</span><span class='lbracket'>[</span><span class='id identifier rubyid_filename'>filename</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:filetype</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_filetype'>filetype</span><span class='period'>.</span><span class='id identifier rubyid_backup'>backup</span>
  <span class='id identifier rubyid_filetype'>filetype</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_contents'>contents</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prefetch-instance_method">
  
    - (<tt>Object</tt>) <strong>prefetch</strong>(resources = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Match up all resources that have existing providers.</p>

<p>Pass over all provider instances, and see if there is a resource with the
same namevar as a provider instance. If such a resource exists, set the
provider field of that resource to the existing provider.</p>

<p>This is a hook method that will be called by Puppet::Transaction#prefetch</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>resources</span>
      
      
        <span class='type'>(<tt>Hash&lt;String, Puppet::Resource&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 173</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prefetch'>prefetch</span><span class='lparen'>(</span><span class='id identifier rubyid_resources'>resources</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='comment'># generate hash of {provider_name =&gt; provider}
</span>  <span class='id identifier rubyid_providers'>providers</span> <span class='op'>=</span> <span class='id identifier rubyid_instances'>instances</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_instance'>instance</span><span class='op'>|</span>
    <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_instance'>instance</span>
    <span class='id identifier rubyid_hash'>hash</span>
  <span class='kw'>end</span>

  <span class='comment'># For each prefetched resource, try to match it to a provider
</span>  <span class='id identifier rubyid_resources'>resources</span><span class='period'>.</span><span class='id identifier rubyid_each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_resource_name'>resource_name</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_provider'>provider</span> <span class='op'>=</span> <span class='id identifier rubyid_providers'>providers</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource_name'>resource_name</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span> <span class='op'>=</span> <span class='id identifier rubyid_provider'>provider</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_class!-instance_method">
  
    - (<tt>Object</tt>) <strong>validate_class!</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Validate that the required methods are available.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>Puppet::DevError if an expected method is unavailable</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppetx/filemapper.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_class!'>validate_class!</span>
  <span class='id identifier rubyid_required_class_hooks'>required_class_hooks</span>    <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:target_files</span><span class='comma'>,</span> <span class='symbol'>:parse_file</span><span class='comma'>,</span> <span class='symbol'>:format_file</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_required_instance_hooks'>required_instance_hooks</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:select_file</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_required_class_hooks'>required_class_hooks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>DevError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='rbrace'>}</span><span class='tstring_content'> has not implemented `self.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='rbrace'>}</span><span class='tstring_content'>`</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='id identifier rubyid_method'>method</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_required_instance_hooks'>required_instance_hooks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>DevError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='rbrace'>}</span><span class='tstring_content'> has not implemented `#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='rbrace'>}</span><span class='tstring_content'>`</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span> <span class='id identifier rubyid_method'>method</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun Sep 30 15:16:24 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.3).
</div>

  </body>
</html>